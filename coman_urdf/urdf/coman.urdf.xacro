<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro" name="COMAN">

<!-- 
  ROS urdf definition of the COMAN humanoid robot by Istituto Italiano di Tecnologia
  
  DO NOT INCLUDE THIS FILE DIRECTLY! USE coman_robot.urdf.xacro INSTEAD!

  Author: Enrico Mingo & Alessio Rocchi

  Inertial matrix has to be in CoM frame (URDF specs)

  Velocity and effort limits are fake!
-->


<!-- ************ MODEL CONFIGURATION ************ -->
<xacro:include filename="$(find coman_urdf)/urdf/coman_config.urdf.xacro" />

<!-- Head -->
<!-- This links are defined in order to be compliant with http://www.ros.org/reps/rep-0120.html#coordinate-frames
and to define the end effectors of the robot.
The coordinate frame called gaze defines the head position and orientation. The orientation indicates in which direction the head appears to be looking regardless of any sensors (camera for instance). -->
<link name="gaze"/>

<xacro:if value="${GAZEBO_COMAN_USES_XTION}">

<xacro:include filename="$(find coman_urdf)/urdf/sensors/xtion.urdf.xacro" />

    <gazebo reference="gaze">
        <sensor name="openni_camera_camera" type="depth">
          <always_on>1</always_on>
          <visualize>1</visualize>

          <camera name="__default__">
            <horizontal_fov>1.047</horizontal_fov>
            <image>
              <width>640</width>
              <height>480</height>
              <format>R8G8B8</format>
            </image>
            <depth_camera>
              <output>depths</output>
            </depth_camera>
            <clip>
              <near>0.1</near>
              <far>100</far>
            </clip>
          </camera>

          <plugin name="camera_controller" filename="libgazebo_ros_openni_kinect.so">
            <alwaysOn>true</alwaysOn>
            <updateRate>10.0</updateRate>
            <cameraName>camera</cameraName>
            <frameName>camera_link</frameName>
            <imageTopicName>rgb/image_raw</imageTopicName>
            <depthImageTopicName>depth/image_raw</depthImageTopicName>
            <pointCloudTopicName>depth/points</pointCloudTopicName>
            <cameraInfoTopicName>rgb/camera_info</cameraInfoTopicName>
            <depthImageCameraInfoTopicName>depth/camera_info</depthImageCameraInfoTopicName>
            <pointCloudCutoff>0.4</pointCloudCutoff>
            <hackBaseline>0.07</hackBaseline>
            <distortionK1>0.0</distortionK1>
            <distortionK2>0.0</distortionK2>
            <distortionK3>0.0</distortionK3>
            <distortionT1>0.0</distortionT1>
            <distortionT2>0.0</distortionT2>
            <CxPrime>0.0</CxPrime>
            <Cx>0.0</Cx>
            <Cy>0.0</Cy>
            <focalLength>0.0</focalLength>
          </plugin>

        </sensor>
    </gazebo>
    
</xacro:if>

<xacro:unless value="${GAZEBO_COMAN_USES_XTION}">
<joint name="gaze_joint" type="fixed">
	<parent link="torso"/>
	<child link="gaze"/>
	<origin xyz="0 0 0.1" rpy="0 0 0" />
</joint>
</xacro:unless>

  

<!-- ************ COMAN BASE ************** -->
<xacro:include filename="$(find coman_urdf)/urdf/coman_base.urdf.xacro"/>

<!-- ************ FOREARMS ************ -->
<!-- This links are defined in order to be compliant with http://www.ros.org/reps/rep-0120.html#coordinate-frames
and to define the end effectors of the robot -->

<!-- position and orientation of the arm regardless of the tool (grasping device for instance) attached to it -->
<link name="l_wrist"/>
<link name="r_wrist"/>

<xacro:if value="${GAZEBO_COMAN_USES_NO_FOREARMS}">
    <xacro:include filename="$(find coman_urdf)/urdf/parts/no_forearms.urdf.xacro" />
</xacro:if>

<xacro:if value="${GAZEBO_COMAN_USES_7DOF_FOREARMS_DRC_14}">
    <xacro:include filename="$(find coman_urdf)/urdf/parts/7DOF_forearms_DRC_14.urdf.xacro" />
</xacro:if>

<!-- ************ HANDS ************ -->

  <xacro:if value="${GAZEBO_COMAN_USES_7DOF_FOREARMS_DRC_14}">

    <xacro:include filename="$(find coman_urdf)/urdf/soft_hand.urdf.xacro" />	

    <xacro:if value="${GAZEBO_COMAN_USES_SOFTHANDS_DRC_sw1_14}">
      <joint name="r_handj" type="fixed">
        <parent link="RWrMot3"/>
        <child link="RSoftHand"/>
        <origin xyz="0 0 -0.07" rpy="0 0 0"/>
      </joint>

      <joint name="l_handj" type="fixed">
        <parent link="LWrMot3"/>
        <child link="LSoftHand"/>
        <origin xyz="0 0 -0.07" rpy="0 0 0"/>
      </joint>
    </xacro:if>

    <xacro:unless value="${GAZEBO_COMAN_USES_SOFTHANDS_DRC_sw1_14}">
      <joint name="r_handj" type="revolute">
        <parent link="RWrMot3"/>
        <child link="RSoftHand"/>
        <origin xyz="0 0 -0.04" rpy="0 0 0"/>
        <axis xyz="1 0 0" />
        <limit velocity="4.0" effort="5" lower="0.0" upper="1.57075" />
        <dynamics friction="0" damping="3.0"/>
      </joint>

      <joint name="l_handj" type="revolute">
        <parent link="LWrMot3"/>
        <child link="LSoftHand"/>
        <origin xyz="0 0 -0.04" rpy="0 0 0"/>
        <axis xyz="1 0 0" />
        <limit velocity="4.0" effort="5" lower="-1.57075" upper="0.0" />
        <dynamics friction="0" damping="3.0"/>
      </joint>
    </xacro:unless>

  </xacro:if>

<!-- IMU -->
<xacro:include filename="$(find coman_urdf)/urdf/sensors/imu.urdf.xacro"/>
  
</robot>




